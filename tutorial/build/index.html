<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>The JGroups tutorial</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */

.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */

</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>The JGroups tutorial</h1>
<span id="author">Bela Ban &lt;belaban@yahoo.com&gt;</span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Copyright Red Hat 1998 - 2015</p></div>
<div class="paragraph"><p>This document is licensed under the
<a href="http://creativecommons.org/licenses/by-sa/3.0/us/legalcode">"Creative Commons Attribution-ShareAlike (CC-BY-SA) 3.0"</a>
license.</p></div>
<div class="paragraph"><div class="title">About the tutorial</div><p>This is a short tutorial on how to install JGroups and write a simple application. The goal is to show how to
configure JGroups and how to write a simple application showing the major methods of the API.</p></div>
<div class="paragraph"><p>Bela Ban, Kreuzlingen, Switzerland, August 2014</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">1. Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_download">1.1. Download</h3>
<div class="paragraph"><p>JGroups can be downloaded <a href="http://sourceforge.net/projects/javagroups/files/JGroups">here</a>.
For this tutorial, I&#8217;m using the binary version of JGroups 3.0, so download one of the jgroups-3.x.y.jar
files (e.g. jgroups-3.0.0.Final.jar).</p></div>
<div class="paragraph"><p>This JAR file contains:</p></div>
<div class="ulist"><ul>
<li>
<p>
JGroups core, demo and (selected) test classes
</p>
</li>
<li>
<p>
INSTALL.html: detailed configuration instructions plus trouble shooting
</p>
</li>
<li>
<p>
Sample configuration files, e.g. udp.xml or tcp.xml
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note" />
</td>
<td class="content">JGroups 3.0 requires JDK 6 or higher.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">1.2. Configuration</h3>
<div class="paragraph"><p>Add jgroups-3.x.y.jar to your classpath. If you use the log4j logging system, you also have to add log4j.jar
(this is not necessary if you use the JDK logging system).</p></div>
</div>
<div class="sect2">
<h3 id="_testing_your_setup">1.3. Testing your Setup</h3>
<div class="paragraph"><p>To see whether your system can find the JGroups classes, execute the following command:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>java org.jgroups.Version</code></pre>
</div></div>
<div class="paragraph"><p>or</p></div>
<div class="listingblock">
<div class="content">
<pre><code>java -jar jgroups-3.x.y.jar</code></pre>
</div></div>
<div class="paragraph"><p>You should see the following output (more or less) if the class is found:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$  java org.jgroups.Version
   Version:      3.5.0.Final</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_running_a_demo_program">1.4. Running a Demo Program</h3>
<div class="paragraph"><p>To test whether JGroups works okay on your machine, run the following command twice:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>java -Djava.net.preferIPv4Stack=true org.jgroups.demos.Draw</code></pre>
</div></div>
<div class="paragraph"><p>Two whiteboard windows should appear as shown below:</p></div>
<div class="paragraph"><p><span class="image">
<img src="./images/DrawScreenshot.png" alt="Draw" />
</span></p></div>
<div class="paragraph"><p>If you started them simultaneously, they could initially show a membership of 1 in their title bars. After some time,
both windows should show 2. This means that the two instances found each other and formed a cluster.</p></div>
<div class="paragraph"><p>When drawing in one window, the second instance should also be updated. As the default group transport uses
IP multicast, make sure that - if you want start the 2 instances in different subnets - IP multicast is enabled.
If this is not the case, the 2 instances won&#8217;t <em>find</em> each other and the example won&#8217;t work.</p></div>
<div class="paragraph"><p>If the 2 instances find each other and form a cluster, you can skip ahead to the next chapter
("Writing a simple application").</p></div>
</div>
<div class="sect2">
<h3 id="_using_jgroups_without_a_network">1.5. Using JGroups without a network</h3>
<div class="paragraph"><p>(You may skip this section if the 2 instances found each other correctly in the previous section).</p></div>
<div class="paragraph"><p>Sometimes there isn&#8217;t a network connection (e.g. DSL modem is down), or we want to multicast only on the
local machine. To do this, we can use the loopback device (127.0.0.1):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>java -Djgroups.bind_addr=127.0.0.1 -Djava.net.preferIPv4Stack=true org.jgroups.demos.Draw</code></pre>
</div></div>
<div class="paragraph"><p>You should again see 2 instances of Draw which form a cluster. If this is not the case, you may
have to add a multicast route to the loopback device (this requires superuser or admin privileges):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>route add -net 224.0.0.0 netmask 240.0.0.0 dev lo</code></pre>
</div></div>
<div class="paragraph"><p>This means that all traffic directed to the 224.0.0.0 network will be sent to the loopback interface,
which means it doesn&#8217;t need any network to be running.</p></div>
<div class="paragraph"><p>Typical home networks have a gateway/firewall with 2 NICs: the first (eth0) is connected to the outside
world (Internet Service Provider), the second (eth1) to the internal network, with the gateway
firewalling/masquerading traffic between the internal and external networks. If no route for multicast
traffic is added, the default will be to use the default gateway, which will typically direct the
multicast traffic towards the ISP. To prevent this (e.g. ISP drops multicast traffic, or latency is too
high), we recommend to add a route for multicast traffic which goes to the internal network (e.g. eth1).</p></div>
</div>
<div class="sect2">
<h3 id="_trouble_shooting">1.6. Trouble shooting</h3>
<div class="paragraph"><p>If the 2 Draw instances don&#8217;t find each other, read INSTALL.html, which comes with JGroups and has more
detailed trouble shooting information. In a nutshell, there are multiple possible reasons the cluster
doesn&#8217;t form:</p></div>
<div class="ulist"><ul>
<li>
<p>
A firewall discards packets. To verify this, turn the firewall off. If the cluster forms, then turn
  the firewall back on and selectively add rules to let JGroups traffic pass.
</p>
</li>
<li>
<p>
Use of IPv6. JGroups does work with IPv6, but some JDK implementations still have issues with it, so
  you can turn IPv6 off by passing the "-Djava.net.preferIPv4Stack=true" system property to the JVM.
  You can force use of IPv6 addresses by using setting system property
  -Djava.net.preferIPv6Addresses=true. If you use IPv6 addresses, you should also define IPv6 addresses
  in your configuration; e.g. if you set bind_addr="192.168.1.5" in UDP, JGroups will try to pick
  IPv4 addresses if an IPv4 stack is available, or you&#8217;re running a dual stack.
</p>
</li>
<li>
<p>
You don&#8217;t use the right network interface (NIC): define the NIC with the -Djgroups.bind_addr system
  property:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>java -Djgroups.bind_addr=192.168.5.2 java.org.jgroups.demos.Draw</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
There is no multicast route for the chosen NIC.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_a_simple_application">2. Writing a simple application</h2>
<div class="sectionbody">
<div class="paragraph"><p>The goal of this chapter is to write a simple text-based chat application (SimpleChat), with the following features:</p></div>
<div class="ulist"><ul>
<li>
<p>
All instances of SimpleChat find each other and form a cluster.
</p>
</li>
<li>
<p>
There is no need to run a central chat server to which instances have to connect. Therefore, there is no
  single point of failure.
</p>
</li>
<li>
<p>
A chat message is sent to all instances of the cluster.
</p>
</li>
<li>
<p>
An instance gets a notification callback when another instance leaves (or crashes) and when other
  instances join.
</p>
</li>
<li>
<p>
(Optional) We maintain a common cluster-wide shared state, e.g. the chat history. New instances acquire
  that history from existing instances.
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_jgroups_overview">2.1. JGroups overview</h3>
<div class="paragraph"><p>JGroups uses a JChannel as the main API to connect to a cluster, send and receive messages, and to register
listeners that are called when things (such as member joins) happen.</p></div>
<div class="paragraph"><p>What is sent around are Messages, which contain a byte buffer (the payload), plus the sender&#8217;s and receiver&#8217;s address.
Addresses are subclasses of org.jgroups.Address, and usually contain an IP address plus a port.</p></div>
<div class="paragraph"><p>The list of instances in a cluster is called a View, and every instance contains
exactly the same View. The list of the addresses of all instances can get retrieved by calling
View.getMembers().</p></div>
<div class="paragraph"><p>Instances can only send or receive messages after they&#8217;ve joined a cluster.</p></div>
<div class="paragraph"><p>When an instance wants to leave the cluster, methods JChannel.disconnect() or JChannel.close() can be called.
The latter actually calls disconnect() if the channel is still connected before closing the channel.</p></div>
</div>
<div class="sect2">
<h3 id="creating-channel">2.2. Creating a channel and joining a cluster</h3>
<div class="paragraph"><p>To join a cluster, we&#8217;ll use a JChannel. An instance of JChannel is created with a configuration
(e.g. an XML file) which defines the properties of the channel. To actually connect to the cluster, the
connect(String clustername) method is used. All channel instances which call connect() with the same argument will
join the same cluster. So, let&#8217;s actually create a JChannel and connect to a cluster called "ChatCluster":</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">org.jgroups.JChannel</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleChat</span> <span class="o">{</span>
    <span class="n">JChannel</span> <span class="n">channel</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">user_name</span><span class="o">=</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;user.name&quot;</span><span class="o">,</span> <span class="s">&quot;n/a&quot;</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">channel</span><span class="o">=</span><span class="k">new</span> <span class="n">JChannel</span><span class="o">();</span> <span class="c1">// use the default config, udp.xml</span>
        <span class="n">channel</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s">&quot;ChatCluster&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">SimpleChat</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>First we create a channel using the empty constructor. This configures the channel with the default properties.
Alternatively, we could pass an XML file to configure the channel, e.g. new JChannel("/home/bela/udp.xml").</p></div>
<div class="paragraph"><p>The connect() method joins cluster "ChatCluster". Note that we don&#8217;t need to explicitly create a cluster
beforehand; connect() creates the cluster if it is the first instance. All instances which join the same
cluster will be in the same cluster, for example if we have</p></div>
<div class="ulist"><ul>
<li>
<p>
ch1 joining "cluster-one"
</p>
</li>
<li>
<p>
ch2 joining "cluster-two"
</p>
</li>
<li>
<p>
ch3 joining "cluster-two"
</p>
</li>
<li>
<p>
ch4 joining "cluster-one"
</p>
</li>
<li>
<p>
ch5 joining "cluster-three"
</p>
</li>
</ul></div>
<div class="paragraph"><p>, then we will have 3 clusters: "cluster-one" with instances ch1 and ch4, "cluster-two" with ch2 and ch3,
and "cluster-three" with only ch5.</p></div>
</div>
<div class="sect2">
<h3 id="_the_main_event_loop_and_sending_chat_messages">2.3. The main event loop and sending chat messages</h3>
<div class="paragraph"><p>We now run an event loop, which reads input from stdin (<em>a message</em>) and sends it to all
instances currently in the cluster. When "exit" or "quit" are entered, we fall out of the
loop and close the channel.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">private</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">channel</span><span class="o">=</span><span class="k">new</span> <span class="n">JChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s">&quot;ChatCluster&quot;</span><span class="o">);</span>
    <span class="n">eventLoop</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">eventLoop</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">BufferedReader</span> <span class="n">in</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>
    <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;&gt; &quot;</span><span class="o">);</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">line</span><span class="o">=</span><span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">&quot;quit&quot;</span><span class="o">)</span> <span class="o">||</span> <span class="n">line</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">&quot;exit&quot;</span><span class="o">))</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="n">line</span><span class="o">=</span><span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">user_name</span> <span class="o">+</span> <span class="s">&quot;] &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">;</span>
            <span class="n">Message</span> <span class="n">msg</span><span class="o">=</span><span class="k">new</span> <span class="n">Message</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">line</span><span class="o">);</span>
            <span class="n">channel</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>We added the call to eventLoop() and the closing of the channel to the start() method, and we provided an
implementation of eventLoop.</p></div>
<div class="paragraph"><p>The event loop blocks until a new line is ready (from standard input), then sends a message to the cluster.
This is done by creating a new Message and calling Channel.send() with it as argument.</p></div>
<div class="paragraph"><p>The first argument of the Message constructor is the destination address. A null destination address
sends the message to everyone in the cluster (a non-null address of an instance would send the message
to only one instance).</p></div>
<div class="paragraph"><p>The second argument is our own address. This is null as well, as the stack will insert the
correct address anyway.</p></div>
<div class="paragraph"><p>The third argument is the line that we read from stdin, this uses Java
serialization to create a byte[] buffer and set the message&#8217;s payload. Note that we could also
serialize the object ourselves (which is actually the recommended way !) and use the Message contructor which
takes a byte[] buffer as third argument.</p></div>
<div class="paragraph"><p>The application is now fully functional, except that we don&#8217;t yet receive messages or view notifications.
This is done in the next section below.</p></div>
</div>
<div class="sect2">
<h3 id="_receiving_messages_and_view_change_notifications">2.4. Receiving messages and view change notifications</h3>
<div class="paragraph"><p>Let&#8217;s now register as a Receiver to receive message and view changes. To this end, we could implement
org.jgroups.Receiver, however, I chose to extend ReceiverAdapter which has default
implementations, and only override callbacks (receive() and viewChange()) we&#8217;re interested in. We
now need to extend ReceiverAdapter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleChat</span> <span class="kd">extends</span> <span class="n">ReceiverAdapter</span> <span class="o">{</span>
</pre></div></div></div>
<div class="paragraph"><p>, set the receiver in <code>start()</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">private</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">channel</span><span class="o">=</span><span class="k">new</span> <span class="n">JChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">setReceiver</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s">&quot;ChatCluster&quot;</span><span class="o">);</span>
    <span class="n">eventLoop</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>, and implement <code>receive()</code> and <code>viewAccepted()</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">viewAccepted</span><span class="o">(</span><span class="n">View</span> <span class="n">new_view</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;** view: &quot;</span> <span class="o">+</span> <span class="n">new_view</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">receive</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">getSrc</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="na">getObject</span><span class="o">());</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The viewAccepted() callback is called whenever a new instance joins the cluster, or an existing instance
leaves (crashes included). Its toString() method prints out the view ID (an increasing ID) and a list of
the current instances in the cluster</p></div>
<div class="paragraph"><p>In receive(), we get a Message as argument. We simply get its buffer as an object (again using Java
serialization) and print it to stdout. We also print the sender&#8217;s address (Message.getSrc()).</p></div>
<div class="paragraph"><p>Note that we could also get the byte[] buffer (the payload) by calling Message.getBuffer() and then
de-serializing it ourselves, e.g. String line=new String(msg.getBuffer()).</p></div>
</div>
<div class="sect2">
<h3 id="_trying_out_the_simplechat_application">2.5. Trying out the SimpleChat application</h3>
<div class="paragraph"><p>Now that the demo chat application is fully functional, let&#8217;s try it out. Start an instance of SimpleChat:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>[linux]/home/bela$ java SimpleChat

-------------------------------------------------------------------
GMS: address=linux-48776, cluster=ChatCluster, physical address=192.168.1.5:42442
-------------------------------------------------------------------
** view: [linux-48776|0] [linux-48776]
&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The name of this instance is linux-48776 and the physical address is 192.168.1.5:42442 (IP address:port).
A name is generated by JGroups (using the hostname and a random short) if the user doesn&#8217;t set it. The name
stays with an instance for its lifetime, and maps to an underlying UUID. The UUID then maps to a
physical address.</p></div>
<div class="paragraph"><p>We started the first instance, let&#8217;s start the second instance:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[linux]/home/bela$ java SimpleChat

-------------------------------------------------------------------
GMS: address=linux-37238, cluster=ChatCluster, physical address=192.168.1.5:40710
-------------------------------------------------------------------
** view: [linux-48776|1] [linux-48776, linux-37238]
&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The cluster list is now [linux-48776, linux-37238], showing the first and second instance that
joined the cluster. Note that the first instance (linux-48776) also received the same view, so both
instances have the exact same view with the same ordering of its instances in the list. The instances are
listed in order of joining the cluster, with the oldest instance as first element.</p></div>
<div class="paragraph"><p>Sending messages is now as simple as typing a message after the prompt and pressing return. The message will
be sent to the cluster and therefore it will be received by both instances, including the sender.</p></div>
<div class="paragraph"><p>When "exit" or "quit" is entered, then the instance will leave the cluster. This means, a new
view will be installed immediately.</p></div>
<div class="paragraph"><p>To simulate a crash, simply kill an instance (e.g. via CTRL-C, or from the process manager). The other
surviving instance will receive a new view, with only 1 instance (itself) and excluding the crashed
instance.</p></div>
</div>
<div class="sect2">
<h3 id="_extra_credits_maintaining_shared_cluster_state">2.6. Extra credits: maintaining shared cluster state</h3>
<div class="paragraph"><p>One of the use cases of JGroups is to maintain state that is replicated across a cluster. For example, state
could be all the HTTP sessions in a web server. If those sessions are replicated across a cluster, then
clients can access any server in the cluster after a server which hosted the client&#8217;s session crashed,
and the user sessions will still be available.</p></div>
<div class="paragraph"><p>Any update to a session is replicated across the cluster, e.g. by serializing the attribute that was
modified and sending the modification to every server in the cluster via JChannel.send(). This is needed
so that all servers have the same state.</p></div>
<div class="paragraph"><p>However, what happens when a new server is started ? That server has to somehow get the state
(e.g. all HTTP sessions) from an existing server in the cluster.
This is called <em>state transfer</em>.</p></div>
<div class="paragraph"><p>State transfer in JGroups is done by implementing 2 (getState() and setState()) callbacks and
calling the JChannel.getState() method.
Note that, in order to be able to use state transfer in an application, the protocol stack has
to have a state transfer protocol (the default stack used by the demo app does).</p></div>
<div class="paragraph"><p>The start() method is now modified to include the call to JChannel.getState():</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">private</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">channel</span><span class="o">=</span><span class="k">new</span> <span class="n">JChannel</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">setReceiver</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s">&quot;ChatCluster&quot;</span><span class="o">);</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">getState</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>
    <span class="n">eventLoop</span><span class="o">();</span>
    <span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The getState() method&#8217;s first argument is the target instance, and null means get the state from the first
instance (the coordinator). The second argument is the timeout; here&#8217;s we&#8217;re willing to wait for 10 secs
to transfer the state. If the state cannot be transferred within this time, then an exception will be
thrown. 0 means wait forever.</p></div>
<div class="paragraph"><p>ReceiverAdapter defines a callback getState() which is called on an existing instance
(usually the coordinator) to fetch the cluster state. In our demo application, we define the state to be
the chat conversation. This is a simple list, to the tail of which we add every message we receive.
(Note that this is probably not the best example for state, as this state always grows. As a workaround,
we could have a bounded list, which is not done here though).</p></div>
<div class="paragraph"><p>The list is defined as an instance variable:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">state</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
</pre></div></div></div>
<div class="paragraph"><p>Of course, now we need to modify receive() to add each received message to our state:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">receive</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">line</span><span class="o">=</span><span class="n">msg</span><span class="o">.</span><span class="na">getSrc</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="na">getObject</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
    <span class="kd">synchronized</span><span class="o">(</span><span class="n">state</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The getState() callback implementation is</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">getState</span><span class="o">(</span><span class="n">OutputStream</span> <span class="n">output</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="kd">synchronized</span><span class="o">(</span><span class="n">state</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Util</span><span class="o">.</span><span class="na">objectToStream</span><span class="o">(</span><span class="n">state</span><span class="o">,</span> <span class="k">new</span> <span class="n">DataOutputStream</span><span class="o">(</span><span class="n">output</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The getState() method is called in the <em>state provider</em>, ie. an existing instance, to
return the shared cluster state. It is passed an output stream to which the state has to be written. Note
that JGroups closes that stream automatically after the state has been written, even in the case of an
exception, so the stream doesn&#8217;t need to be closed.</p></div>
<div class="paragraph"><p>Since access to <code>state</code> may be concurrent, we synchronize it. Then we call Util.objectToStream()
which is a JGroups utility method writing an object to an output stream.</p></div>
<div class="paragraph"><p>The setState() method is called on the <em>state requester</em>, ie. the instance
which called JChannel.getState(). Its task is to read the state from the input stream and set it
accordingly:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setState</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">input</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>
    <span class="n">list</span><span class="o">=(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span><span class="n">Util</span><span class="o">.</span><span class="na">objectFromStream</span><span class="o">(</span><span class="k">new</span> <span class="n">DataInputStream</span><span class="o">(</span><span class="n">input</span><span class="o">));</span>
    <span class="kd">synchronized</span><span class="o">(</span><span class="n">state</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">state</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; messages in chat history):&quot;</span><span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">str:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>We again call a JGroups utility method (Util.objectFromStream()) to create an object from an input stream.</p></div>
<div class="paragraph"><p>Then we synchronize on <code>state</code>, and set its contents from the received state.</p></div>
<div class="paragraph"><p>We also print the number of messages in the received chat history to stdout. Note that this is not
feasible with a large chat history, but - again - we could have a bounded chat history list.</p></div>
</div>
<div class="sect2">
<h3 id="_conclusion">2.7. Conclusion</h3>
<div class="paragraph"><p>In this tutorial, we showed how to create a channel, join and leave a cluster, send and receive messages,
get notified of view changes and implement state transfer. This is the core functionality provided by
JGroups through the <code>JChannel</code> and <code>Receiver</code> APIs.</p></div>
<div class="paragraph"><p>JGroups has two more areas that weren&#8217;t covered: building blocks and the protocol stack.</p></div>
<div class="paragraph"><p>Building blocks are classes residing on top of a JChannel that provide a higher abstraction level, e.g.
request-response correlators, cluster-wide method calls, replicated hashmaps and so forth.</p></div>
<div class="paragraph"><p>The protocol stack allows for complete customization of JGroups: protocols can be configured, removed,
replaced, enhanced, or new protocols can be written and added to the stack.</p></div>
<div class="paragraph"><p>The code for SimpleChat can be found ./code/SimpleChat.java[here].</p></div>
<div class="paragraph"><p>Here are some links for further information about JGroups:</p></div>
<div class="ulist"><ul>
<li>
<p>
SimpleChat code: <a href="file:./code/SimpleChat.java">SimpleChat.java</a>
</p>
</li>
<li>
<p>
JGroups web site: <a href="http://www.jgroups.org">http://www.jgroups.org</a>
</p>
</li>
<li>
<p>
Downloads: <a href="http://sourceforge.net/projects/javagroups/files/JGroups/">here</a>
</p>
</li>
<li>
<p>
JIRA bug tracking: <a href="http://jira.jboss.com/jira/browse/JGRP">http://jira.jboss.com/jira/browse/JGRP</a>
</p>
</li>
<li>
<p>
Mailing lists: <a href="http://sourceforge.net/mail/?group_id=6081">http://sourceforge.net/mail/?group_id=6081</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2014-08-12 12:33:13 CEST
</div>
</div>
</body>
</html>
